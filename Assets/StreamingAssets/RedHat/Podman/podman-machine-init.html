<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>podman-machine-init 1</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h2 id="name">NAME</h2>
<p>podman-machine-init - Initialize a new virtual machine</p>
<h2 id="synopsis">SYNOPSIS</h2>
<p><strong>podman machine init</strong> [<em>options</em>]
[<em>name</em>]</p>
<h2 id="description">DESCRIPTION</h2>
<p>Initialize a new virtual machine for Podman.</p>
<p>The default machine name is <code>podman-machine-default</code>. If a
machine name is not specified as an argument, then the new machine will
be named <code>podman-machine-default</code>.</p>
<p>Rootless only.</p>
<p>Podman on MacOS and Windows requires a virtual machine. This is
because containers are Linux - containers do not run on any other OS
because containers' core functionality are tied to the Linux kernel.
Podman machine must be used to manage MacOS and Windows machines, but
can be optionally used on Linux.</p>
<p><strong>podman machine init</strong> initializes a new Linux virtual
machine where containers are run. SSH keys are automatically generated
to access the VM, and system connections to the root account and a user
account inside the VM are added.</p>
<p>By default, the VM distribution is a custom <a
href="https://getfedora.org/en/coreos?stream=stable">Fedora CoreOS</a>
based image pushed to quay.io/podman/machine-os (build in
https://github.com/containers/podman-machine-os). WSL is an exception
and is based on a custom Fedora image.</p>
<p>To check if there is an upgrade available for your machine os, you
can run the following command:</p>
<pre><code>$ podman machine ssh &#39;sudo rpm-ostree upgrade --check&#39;
</code></pre>
<p>If an update is available, you can rerun the above command and remove
the <code>--check</code> and your operating system will be updated.
After updating, you must stop and start your machine with
<code>podman machine stop &amp;&amp; podman machine start</code> for it
to take effect.</p>
<p>The above mechanism is only used to update patch (Z) versions of
podman. For updates to new major and minor version (X.Y) use the
<strong><a href="podman-machine-os-apply.html">podman machine os
apply</a></strong> command, see the docs there for more information.</p>
<p>Note: Updating as described above can result in version mismatches
between Podman on the host and Podman in the machine. Executing
<code>podman info</code> should reveal versions of both. A configuration
where the Podman host and machine mismatch are unsupported.</p>
<p>To update the WSL image you must run dnf update inside, use the
following command:</p>
<pre><code>$ podman machine ssh dnf update</code></pre>
<p>Default Podman machine settings can be set via the [machine] section
in the containers.conf(5) file.</p>
<h2 id="options">OPTIONS</h2>
<h4 id="cpusnumber"><strong>--cpus</strong>=<em>number</em></h4>
<p>Number of CPUs.</p>
<h4
id="disk-sizenumber"><strong>--disk-size</strong>=<em>number</em></h4>
<p>Size of the disk for the guest VM in GiB.</p>
<h4 id="help"><strong>--help</strong></h4>
<p>Print usage statement.</p>
<h4 id="ignition-path"><strong>--ignition-path</strong></h4>
<p>Fully qualified path of the ignition file.</p>
<p>If an ignition file is provided, the file is copied into the user's
CONF_DIR and renamed. Additionally, no SSH keys are generated, nor are
any system connections made. It is assumed that the user does these
things manually or handled otherwise.</p>
<h4 id="image"><strong>--image</strong></h4>
<p>Fully qualified registry, path, or URL to a VM image. Registry target
must be in the form of
<code>docker://registry/repo/image:version</code>.</p>
<p>Note: Only images provided by podman will be supported.</p>
<h4 id="memory--mnumber"><strong>--memory</strong>,
<strong>-m</strong>=<em>number</em></h4>
<p>Memory (in MiB). Note: 1024MiB = 1GiB.</p>
<h4 id="now"><strong>--now</strong></h4>
<p>Start the virtual machine immediately after it has been
initialized.</p>
<h4 id="playbook"><strong>--playbook</strong></h4>
<p>Add the provided Ansible playbook to the machine and execute it after
the first boot.</p>
<p>Note: The playbook will be executed with the same privileges given to
the user in the virtual machine. The playbook provided cannot include
other files from the host system, as they will not be copied. Use of the
<code>--playbook</code> flag will require the image to include Ansible.
The default image provided will have Ansible included.</p>
<h4 id="rootful"><strong>--rootful</strong></h4>
<p>Whether this machine prefers rootful (<code>true</code>) or rootless
(<code>false</code>) container execution. This option determines the
remote connection default if there is no existing remote connection
configurations.</p>
<p>API forwarding, if available, follows this setting.</p>
<h4 id="swap--snumber"><strong>--swap</strong>,
<strong>-s</strong>=<em>number</em></h4>
<p>Swap (in MiB). Note: 1024MiB = 1GiB.</p>
<p>Renders a <code>zram-generator.conf</code> file with zram-size set to
the value passed to --swap</p>
<h4 id="timezone"><strong>--timezone</strong></h4>
<p>Set the timezone for the machine and containers. Valid values are
<code>local</code> or a <code>timezone</code> such as
<code>America/Chicago</code>. A value of <code>local</code>, which is
the default, means to use the timezone of the machine host.</p>
<p>The timezone setting is not used with WSL. WSL automatically sets the
timezone to the same as the host Windows operating system.</p>
<h4
id="usbbusnumberdevnumnumber-or-vendorhexadecimalproducthexadecimal"><strong>--usb</strong>=<em>bus=number,devnum=number</em>
or <em>vendor=hexadecimal,product=hexadecimal</em></h4>
<p>Assign a USB device from the host to the VM via USB passthrough. Only
supported for QEMU Machines.</p>
<p>The device needs to have proper permissions in order to be passed to
the machine. This means the device needs to be under your user
group.</p>
<p>Note that using bus and device number are simpler but the values can
change every boot or when the device is unplugged.</p>
<p>When specifying a USB using vendor and product ID's, if more than one
device has the same vendor and product ID, the first available device is
assigned.</p>
<h4
id="user-mode-networking"><strong>--user-mode-networking</strong></h4>
<p>Indicates that this machine relays traffic from the guest through a
user-space process running on the host. In some VPN configurations the
VPN may drop traffic from alternate network interfaces, including VM
network devices. By enabling user-mode networking (a setting of
<code>true</code>), VPNs observe all podman machine traffic as coming
from the host, bypassing the problem.</p>
<p>When the qemu backend is used (Linux, Mac), user-mode networking is
mandatory and the only allowed value is <code>true</code>. In contrast,
The Windows/WSL backend defaults to <code>false</code>, and follows the
standard WSL network setup. Changing this setting to <code>true</code>
on Windows/WSL informs Podman to replace the WSL networking setup on
start of this machine instance with a user-mode networking distribution.
Since WSL shares the same kernel across distributions, all other running
distributions reuses this network. Likewise, when the last machine
instance with a <code>true</code> setting stops, the original networking
setup is restored.</p>
<h4 id="username"><strong>--username</strong></h4>
<p>Username to use for executing commands in remote VM. Default value is
<code>core</code> for FCOS and <code>user</code> for Fedora (default on
Windows hosts). Should match the one used inside the resulting VM
image.</p>
<h4 id="volume--vsourcetargetoptions"><strong>--volume</strong>,
<strong>-v</strong>=<em>source:target[:options]</em></h4>
<p>Mounts a volume from source to target.</p>
<p>Create a mount. If /host-dir:/machine-dir is specified as the
<code>*source:target*</code>, Podman mounts <em>host-dir</em> in the
host to <em>machine-dir</em> in the Podman machine.</p>
<p>Additional options may be specified as a comma-separated string.
Recognized options are: * <strong>ro</strong>: mount volume read-only *
<strong>rw</strong>: mount volume read/write (default) *
<strong>security_model=[model]</strong>: specify 9p security model (see
below)</p>
<p>Note: The following destinations are forbidden for volumes:
<code>/bin</code>, <code>/boot</code>, <code>/dev</code>,
<code>/etc</code>, <code>/home</code>, <code>/proc</code>,
<code>/root</code>, <code>/run</code>, <code>/sbin</code>,
<code>/sys</code>, <code>/tmp</code>, <code>/usr</code>, and
<code>/var</code>. Subdirectories of these destinations are allowed but
users should be careful to not mount to important directories as
unexpected results may occur.</p>
<p>The 9p security model [determines]
https://wiki.qemu.org/Documentation/9psetup#Starting_the_Guest_directly
if and how the 9p filesystem translates some filesystem operations
before actual storage on the host.</p>
<p>In order to allow symlinks to work, on MacOS the default security
model is <em>none</em>.</p>
<p>The value of <em>mapped-xattr</em> specifies that 9p store symlinks
and some file attributes as extended attributes on the host. This is
suitable when the host and the guest do not need to interoperate on the
shared filesystem, but has caveats for actual shared access; notably,
symlinks on the host are not usable on the guest and vice versa. If
interoperability is required, then choose <em>none</em> instead, but
keep in mind that the guest is not able to do things that the user
running the virtual machine cannot do, e.g. create files owned by
another user. Using <em>none</em> is almost certainly the best choice
for read-only volumes.</p>
<p>Example:
<code>-v "$HOME/git:$HOME/git:ro,security_model=none"</code></p>
<p>Default volume mounts are defined in <em>containers.conf</em>. Unless
changed, the default values is <code>$HOME:$HOME</code>.</p>
<p><strong>Note on Windows Subsystem for Linux (WSL)</strong> Since all
drives are mounted at <code>/mnt</code> on startup by default in WSL,
passing <code>--volume</code> is redundant and has no effect. The host
home directory for a <code>C:</code> drive will be mounted at
<code>/mnt/c/Users/&lt;my username&gt;</code>.</p>
<h2 id="examples">EXAMPLES</h2>
<p>Initialize the default Podman machine, pulling the content from the
internet.</p>
<pre><code>$ podman machine init</code></pre>
<p>Initialize a Podman machine for the specified name pulling the
content from the internet.</p>
<pre><code>$ podman machine init myvm</code></pre>
<p>Initialize and start a new Podman machine in one step.</p>
<pre><code>podman machine init --now</code></pre>
<p>Initialize the default Podman machine pulling the content from the
internet defaulting to rootful mode. The default is rootless.</p>
<pre><code>$ podman machine init --rootful</code></pre>
<p>Initialize the default Podman machine overriding its disk size
override, pulling the content from the internet.</p>
<pre><code>$ podman machine init --disk-size 50</code></pre>
<p>Initialize the specified Podman machine overriding its memory size,
pulling the content from the internet.</p>
<pre><code>$ podman machine init --memory=1024 myvm</code></pre>
<p>Initialize the default Podman machine with the host directory
<code>/Users</code> mounted into the VM at <code>/Users</code>.</p>
<pre><code>$ podman machine init -v /Users:/Users</code></pre>
<p>Initialize the default Podman machine with a usb device passthrough
specified with options. Only supported for QEMU Machines.</p>
<pre><code>$ podman machine init --usb vendor=13d3,product=5406</code></pre>
<p>Initialize the default Podman machine with a usb device passthrough
with specified with options. Only supported for QEMU Machines.</p>
<pre><code>$ podman machine init --usb bus=1,devnum=3</code></pre>
<h2 id="see-also">SEE ALSO</h2>
<p><strong><a href="podman.html">podman(1)</a></strong>, <strong><a
href="podman-machine.html">podman-machine(1)</a></strong>,
<strong>containers.conf(5)</strong></p>
<h2 id="history">HISTORY</h2>
<p>March 2021, Originally compiled by Ashley Cui <a
href="mailto:acui@redhat.com" class="email">acui@redhat.com</a></p>
</body>
</html>
